<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ADHD ↔ Dissociation Episode Tracker</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect x='2' y='2' width='60' height='60' rx='14' fill='%238b5cf6'/%3E%3Cg fill='%23fff'%3E%3Cpath d='M20 20h24v6H20zM20 30h24v6H20zM20 40h16v6H20z'/%3E%3C/g%3E%3C/svg%3E" type="image/svg+xml">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={theme:{extend:{}}};</script>
  <style>
    body { font-family: system-ui, sans-serif; }
    .card { background: white; border:1px solid #ddd; border-radius: 1rem; padding:1rem; }
    @media (prefers-color-scheme: dark) {
      body { background:#111; color:#eee; }
      .card { background:#1c1c1c; border-color:#333; }
    }
    .btn { padding:0.4rem 0.8rem; border:1px solid #ccc; border-radius:0.5rem; font-size:0.9rem; }
    .btn-primary { background:#111; color:#fff; border:none; }
    @media (prefers-color-scheme: dark) { .btn-primary { background:#fff; color:#111; } }
    .pill { padding:0.2rem 0.5rem; border-radius:9999px; border:1px solid #ccc; font-size:0.75rem; }
  </style>
</head>
<body class="p-4 max-w-6xl mx-auto space-y-6">
  <h1 class="text-2xl font-semibold">ADHD ↔ Dissociation Tracker</h1>
  <p class="text-sm text-gray-500">Data stays in your browser. Export/Import manually if needed.</p>

  <!-- Log Form -->
  <section class="card">
    <h2 class="text-lg font-semibold mb-2">Log an Episode</h2>
    <form id="entryForm" class="space-y-3">
      <input id="dt" type="datetime-local" class="border rounded p-1 w-full">
      <input id="context" placeholder="Context" class="border rounded p-1 w-full">
      <input id="triggers" placeholder="Triggers" class="border rounded p-1 w-full">
      <textarea id="notes" placeholder="Notes" class="border rounded p-1 w-full"></textarea>
      <div class="flex gap-2 flex-wrap">
        <label>Ext Distract <input id="extDistract" type="range" min="0" max="10"></label>
        <label>Dereal <input id="dereal" type="range" min="0" max="10"></label>
        <label>Gap (min)<input id="gap" type="number" value="0" min="0"></label>
        <label>Restless <input id="restless" type="range" min="0" max="10"></label>
        <label>Numb <input id="numbness" type="range" min="0" max="10"></label>
      </div>
      <button type="button" id="classify" class="btn">Classify</button>
      <button type="submit" class="btn-primary">Save</button>
      <span id="classResult" class="ml-2 text-sm"></span>
    </form>
  </section>

  <!-- Weekly Summary -->
  <section class="card">
    <h2 class="text-lg font-semibold mb-2">Weekly Summary</h2>
    <div id="weekSummary" class="text-sm text-gray-700"></div>
    <button id="genNotes" class="btn mt-2">Generate Notes</button>
    <textarea id="notesOut" class="border rounded p-1 w-full mt-2" rows="4"></textarea>
  </section>

  <!-- Threshold Tuning -->
  <section class="card">
    <h2 class="text-lg font-semibold mb-2">Classifier Thresholds</h2>
    <div class="grid grid-cols-2 gap-2">
      <label>ADHD ext ≥ <input id="t_ext" type="number" min="0" max="10"></label>
      <label>ADHD rest ≥ <input id="t_rest" type="number" min="0" max="10"></label>
      <label>ADHD dereal ≤ <input id="t_dereal_max" type="number" min="0" max="10"></label>
      <label>ADHD gap ≤ <input id="t_gap_max" type="number"></label>
      <label>Dissoc dereal ≥ <input id="t_dereal" type="number" min="0" max="10"></label>
      <label>Dissoc numb ≥ <input id="t_numb" type="number" min="0" max="10"></label>
      <label>Dissoc gap ≥ <input id="t_gap" type="number"></label>
    </div>
    <button id="saveThresholds" class="btn-primary mt-2">Save thresholds</button>
  </section>

  <!-- Log Table -->
  <section class="card">
    <h2 class="text-lg font-semibold mb-2">Your Log</h2>
    <table class="w-full text-sm">
      <thead><tr><th>When</th><th>Context</th><th>Type</th><th>Why</th></tr></thead>
      <tbody id="rows"></tbody>
    </table>
  </section>

<script>
const LS_KEY="adhd_dissoc_log_v1", LS_THRESH="adhd_dissoc_thresh_v1";
function loadAll(){try{return JSON.parse(localStorage.getItem(LS_KEY))||[]}catch{return[]}}
function saveAll(l){localStorage.setItem(LS_KEY,JSON.stringify(l))}
function defT(){return{t_ext:6,t_rest:6,t_dereal_max:3,t_gap_max:2,t_dereal:6,t_numb:6,t_gap:10}}
function loadT(){return{...defT(),...(JSON.parse(localStorage.getItem(LS_THRESH))||{})}}
function saveT(t){localStorage.setItem(LS_THRESH,JSON.stringify(t))}
function classify(e,T){const ext=+e.extDistract,dereal=+e.dereal,gap=+e.gap,numb=+e.numbness,rest=+e.restless;
 const adhd=(ext>=T.t_ext||rest>=T.t_rest)&&dereal<=T.t_dereal_max&&gap<=T.t_gap_max;
 const diss=(dereal>=T.t_dereal||numb>=T.t_numb||gap>=T.t_gap);
 if(adhd&&!diss)return{type:"ADHD",why:"Distract/restless high, dereal low, short gap"}
 if(diss&&!adhd)return{type:"Dissociation",why:"Dereal/numb high or long gap"}
 return{type:"Mixed",why:"Signals overlap"}}
let data=loadAll(),T=loadT();
function render(){const tb=document.getElementById("rows");tb.innerHTML="";
 data.forEach(e=>{const tr=document.createElement("tr");
 tr.innerHTML=`<td>${e.dt}</td><td>${e.context}</td><td>${e.type}</td><td>${e.why}</td>`;
 tb.appendChild(tr)}); renderWeek()}
function renderWeek(){const out=document.getElementById("weekSummary");
 const now=Date.now(),wk=now-7*86400000;const arr=data.filter(e=>new Date(e.dt).getTime()>=wk);
 const c={ADHD:0,Dissociation:0,Mixed:0};arr.forEach(e=>c[e.type]++);
 out.textContent=`Entries: ${arr.length} | ADHD:${c.ADHD} Dissoc:${c.Dissociation} Mixed:${c.Mixed}`}
document.getElementById("entryForm").onsubmit=ev=>{
 ev.preventDefault();const e={id:crypto.randomUUID(),dt:document.getElementById("dt").value,
 context:context.value,triggers:triggers.value,notes:notes.value,
 extDistract:extDistract.value,dereal:dereal.value,gap:gap.value,restless:restless.value,numbness:numbness.value};
 const c=classify(e,T);e.type=c.type;e.why=c.why;data.push(e);saveAll(data);render()};
document.getElementById("classify").onclick=()=>{const e={extDistract:extDistract.value,dereal:dereal.value,gap:gap.value,restless:restless.value,numbness:numbness.value};
 const c=classify(e,T);classResult.textContent=`${c.type} — ${c.why}`}
document.getElementById("saveThresholds").onclick=()=>{T={t_ext:+t_ext.value,t_rest:+t_rest.value,t_dereal_max:+t_dereal_max.value,t_gap_max:+t_gap_max.value,t_dereal:+t_dereal.value,t_numb:+t_numb.value,t_gap:+t_gap.value};saveT(T)}
document.getElementById("genNotes").onclick=()=>{notesOut.value=`Weekly: ${weekSummary.textContent}`}
render();
</script>
</body>
</html>
